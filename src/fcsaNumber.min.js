(function(){var e,t={}.hasOwnProperty;e=angular.module("fcsa-number",[]);fcsaHelper=e.factory("fcsa-helper",["fcsaNumberConfig",function(e){var t={};t.toNumber=function(t,n,r){if(!t){return t}var i=t.toString();var s=i.length;var o="";n=n?n:e.defaultOptions.decimalSeparator;r=r?r:e.defaultOptions.thousandsSeparator;for(var u=0;u<s;u++){var a=i[u];if(a!=r){if(a==n){a="."}o+=a}}if(o.indexOf(n.decimalSeparator)==o.length-1){o=o.substring(0,o.length-1)}return o};t.fromNumber=function(t,n,r){t=t+"";var i,s,o;n=n?n:e.defaultOptions.decimalSeparator;r=r?r:e.defaultOptions.thousandsSeparator;var s="";var u=t.indexOf(".");if(u>=0&&u<t.length-1){s=n+(u<t.length?t.substring(u+1):"")}o=t.replace(new RegExp("(\\.\\d*)$"),"");o=o.replace(/(\-?)(0*)(\d+?)(\.(\d*))?$/,"$1$3$4");i=o.replace(new RegExp("(\\d)(?=(\\d{3})+(?!\\d))","g"),"$1"+r);var a=""+i+s;return a};return t}]);e.directive("fcsaNumber",["fcsaNumberConfig","fcsa-helper",function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;r=e.defaultOptions;i=function(e){var n,i,s,o;i=angular.copy(r);if(e&&e.options!=null){o=e.$eval(e.options);for(n in o){if(!t.call(o,n))continue;s=o[n];i[n]=s}}return i};s=function(e){var t=i();var r=n.toNumber(e,t.decimalSeparator,t.thousandsSeparator);return!isNaN(parseFloat(r))&&isFinite(r)};o=function(e){return e<44||e>57||e===47};u=[0,8,13];a=function(e){return u.indexOf(e)===-1};f=function(e){return e!=null&&e.toString().split(i().decimalSeparator).length>2};l=function(e){var t,n;var r=i();if(e>0){t="^-?\\d{1,3}(\\"+r.thousandsSeparator+"?\\d{3})*"+"\\"+r.decimalSeparator+"?\\d{0,"+e+"}$"}else{t="^-?\\d{1,3}(\\"+r.thousandsSeparator+"?\\d{3})*$"}n=new RegExp(t);return function(e){var t=n.test(e);return t}};c=function(e){return function(t,n){return n<=e}};h=function(e){return function(t,n){return n>=e}};p=function(e){return function(t){if(!t){return false}var n=i();var r=t.toString().trim();var s=0;var o=0;var u=false;for(var a=0;a<r.length;a++){var f=r[a];if(f=="-"){continue}if(f>="0"&&f<="9"){if(!u&&f=="0"){if(a<r.length-1&&r[a+1]!=n.decimalSeparator){continue}}else{u=true;s++}}else{if(f==n.thousandsSeparator){continue}else if(f==n.decimalSeparator){if(o++){return s<=e}}else{return false}}}return s<=e}};d=function(e){var t;t=[];t.push(l(e.maxDecimals?e.maxDecimals:0));if(e.max!=null){t.push(c(e.max))}if(e.min!=null){t.push(h(e.min))}if(e.maxDigits!=null){t.push(p(e.maxDigits))}return function(e){var r,o,u,a;if(!s(e)){return false}if(f(e)){return false}var l=i();var c=n.toNumber(e,l.decimalSeparator,l.thousandsSeparator);o=Number(c);for(r=u=0,a=t.length;0<=a?u<a:u>a;r=0<=a?++u:--u){if(!t[r](e,o)){return false}}return true}};v=function(e){var t,n,r;var s=i();var o=s.decimalSeparator;var u=s.thousandsSeparator;var n="";var a=e.indexOf(o);if(a>=0&&a<e.length-1){n=e.substring(a)}r=e.replace(new RegExp("(\\"+o+"\\d*)$"),"");r=r.replace(/(\-?)(0*)(\d+?)(\.(\d*))?$/,"$1$3$4");t=r.replace(new RegExp("(\\d)(?=(\\d{3})+(?!\\d))","g"),"$1"+u);var f=""+t+n;return f};return{restrict:"A",require:"ngModel",scope:{options:"@fcsaNumber"},link:function(e,t,n,r){var s,u;u=i(e);s=d(u);r.$parsers.unshift(function(e){if(!e||s(e)){r.$setValidity("fcsaNumber",true);return e}else{r.$setValidity("fcsaNumber",false);return void 0}});r.$formatters.push(function(e){if(u.nullDisplay!=null&&(!e||e==="")){return u.nullDisplay}if(e==null||!s(e)){return e}r.$setValidity("fcsaNumber",true);e=v(e.toString());if(u.prepend!=null){e=""+u.prepend+e}if(u.append!=null){e=""+e+u.append}return e});t.on("blur",function(){var e,t,n,i,o;t=r.$modelValue;if(t==null||!u.autoFormat||!s(t)){return}o=r.$formatters;for(n=0,i=o.length;n<i;n++){e=o[n];t=e(t)}r.$viewValue=t;return r.$render()});t.on("focus",function(){var e;e=t.val();var n=i();if(n.prepend!=null){e=e.replace(n.prepend,"")}if(n.append!=null){e=e.replace(n.append,"")}if(!n.keepThousandsOnInput&&e&&s(e)){e=e.replace(new RegExp("\\"+n.thousandsSeparator,"g"),"")}t.val(e);return t[0].select()});if(u.preventInvalidInput===true){return t.on("keypress",function(e){if(o(e.which)&&a(e.which)){return e.preventDefault()}})}}}}]);e.provider("fcsaNumberConfig",function(){var e;whatDecimalSeparator=function(){var e=1.1;e=e.toLocaleString();var t=new RegExp("^1(.+)1\\d*$");e=e&&t.exec(e);e=e?e[1]:".";if(e.length==1){var n=e.charCodeAt(0);if(n>127){e=String.fromCharCode(n-128)}}else{console.log("WARNING: auto detection of decimal separator failed, current: "+e)}return e};whatThousandsSeparator=function(){var e=1111;e=e.toLocaleString();var t=new RegExp("^1(.+)111(\\"+whatDecimalSeparator()+"\\d*)?$");e=e&&t.exec(e);e=e?e[1]:",";if(e.length==1){var n=e.charCodeAt(0);if(n>127){e=String.fromCharCode(n-128)}}else{console.log("WARNING: auto detection of thousands separator failed, current: "+e)}return e};e={decimalSeparator:whatDecimalSeparator(),thousandsSeparator:whatThousandsSeparator()};this.setDefaultOptions=function(t){for(var n in t){e[n]=t[n]}return e};this.$get=function(){return{defaultOptions:e}}})}).call(this)